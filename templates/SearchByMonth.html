<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Month</title>
    <style>
        
        body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: linear-gradient(135deg, #f0f4f8, #d9e2ec); /* Light gradient */
    font-family: Arial, sans-serif;
    padding-top: 30px;
    margin: 0;
}

/* Selection Container - Flexbox Layout */
.selection-container {
    display: flex;
    gap: 20px;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    width: 100%;
    max-width: 700px;
}

/* Containers for Dropdowns */
.container {
    background: rgba(255, 255, 255, 0.8); /* Slight transparency */
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1); /* Soft shadow */
    text-align: center;
    width: 100%;
    max-width: 220px;
    backdrop-filter: blur(10px); /* Glass effect */
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: transform 0.2s;
}

.container:hover {
    transform: translateY(-2px); /* Slight lift on hover */
}

/* Heading */
h2 {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
}

/* Select Dropdown Styling */
select {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border: 2px solid #007BFF;
    border-radius: 8px;
    background: white;
    color: #333;
    cursor: pointer;
    outline: none;
    transition: all 0.3s ease;
    box-shadow: 0 3px 6px rgba(0, 123, 255, 0.2);
}

select:focus {
    border-color: #0056b3;
    box-shadow: 0 0 10px rgba(0, 86, 179, 0.4);
}

/* Search Button - Modern Look */
.search-container {
    display: flex;
    align-items: center;
    justify-content: center;
}

.search-btn {
    padding: 10px 18px;
    background: linear-gradient(135deg, #007BFF, #00C9FF);
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
    box-shadow: 0 3px 10px rgba(0, 123, 255, 0.3);
    text-transform: uppercase;
}

.search-btn:hover {
    background: linear-gradient(135deg, #0056b3, #0090c0);
    transform: scale(1.05);
    box-shadow: 0 4px 15px rgba(0, 86, 179, 0.5);
}

.search-btn:disabled {
    background: gray;
    cursor: not-allowed;
    box-shadow: none;
}
table {
            width: 90%;
            max-width: 1200px;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            
            padding: 8px; /* Reduced padding to save space */
            text-align: left;
            border-bottom: 1px solid #ddd;
            vertical-align: top; /* Align text to top for better readability */
            white-space: normal; /* Allows text wrapping */
            word-wrap: break-word; /* Ensures long words break properly */
            max-width: 200px; /* Prevents columns from stretching too much */
            
        }

        th {
            background: #007BFF;
            color: white;
            font-weight: bold;
        }

        tr:hover {
            background: #f1f1f1;
        }

        .save-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-size: 14px;
        }

        .save-btn:hover {
            background: #218838;
        }

/* Make the table container responsive */
.table-container {
    width: 100%;
    overflow-x: auto; /* Enables horizontal scrolling */
    /* white-space: nowrap; Prevents table wrapping */
    padding: 10px; /* Adds spacing around the table */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling for iOS */
}

/* Adjust table styles */
table {
    width: 100%;
    min-width: 900px; /* Ensures the table doesn't shrink too much */
    border-collapse: collapse;
    background: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
}

/* Ensure smooth scrolling */
html, body {
    overflow-x: hidden; /* Prevent horizontal scrolling on the entire page */
}

/* Responsive Design */
@media (max-width: 768px) {
    .selection-container {
        flex-direction: column;
        gap: 15px;
        width: 100%;
        padding: 0 15px;
    }

    .container {
                max-width: 100%;
                padding: 15px;
            }

    h2 {
        font-size: 16px;
    }

    select {
        font-size: 14px;
        padding: 10px;
    }

    .search-btn {
        font-size: 14px;
        padding: 10px 14px;
    }
    body {
        overflow-x: auto; /* Allow horizontal scrolling on mobile */
    }

    .table-container {
        overflow-x: scroll; /* Enables horizontal scrolling */
        scroll-behavior: smooth; /* Smooth scrolling */
    }

}

.radio-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    max-width: 500px;
}

.radio-label {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.7);
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    transition: background 0.3s, transform 0.2s;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.radio-label:hover {
    background-color: #f8f9fa;
    transform: scale(1.02);
}

/* Hide Default Radio Button */
.radio-label input {
    display: none;
}

.radio-custom {
    width: 22px;
    height: 22px;
    border: 2px solid #007bff;
    border-radius: 50%;
    position: relative;
    display: inline-block;
}

.radio-custom::after {
    content: "";
    width: 12px;
    height: 12px;
    background: #007bff;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
    opacity: 0;
}

input:checked + .radio-custom::after {
    opacity: 1;
}
input[type="text"] {
    width: 100%;
    padding: 4px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 12px; /* Adjusted font size */
}
.custom-alert {
    display: none; /* Initially hidden */
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #28a745;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    font-size: 16px;
    font-weight: bold;
    z-index: 1000;
    transition: opacity 0.3s ease-in-out;
}

/* Animation */
@keyframes fadeInOut {
    0% { opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { opacity: 0; }
}

    </style>
    <script>
        function redirectToPage(value) {
            window.location.href = "/fullPersonDetails?selected=" + encodeURIComponent(value);
        }
    </script>
    <script>
        function makeEditable(element) {
            let value = element.innerText;
            element.innerHTML = `<input type='text' value='${value}' />`;
            element.firstChild.focus();
        }

        function showCustomAlert() {
            let alertBox = document.getElementById("customAlert");
            alertBox.style.display = "block";
            alertBox.style.animation = "fadeInOut 3s forwards";

            // Hide the alert after 3 seconds
            setTimeout(() => {
                alertBox.style.display = "none";
            }, 3000);
        }

        function saveRow(button) {
                let row = button.parentElement.parentElement;
                let rowData = {};
                let headers = document.querySelectorAll("th"); // Get all table headers

                row.querySelectorAll("td").forEach((cell, index) => {
                    if (index >= headers.length) {
                        console.warn("Skipping extra cell: ", cell);  // Debugging
                        return; // Skip extra columns if they exist
                    }

                    let header = headers[index]?.innerText.trim(); // Ensure header exists
                    if (!header) {
                        console.warn("Header not found for index", index);  // Debugging
                        return; // Skip if no header found
                    }

                    if (cell.style.display === "none") {  
                        rowData["unique_customer_id"] = cell.innerText; // Capture hidden ID
                    } else if (cell.querySelector("input")) {  
                        rowData[header] = cell.querySelector("input").value;
                        cell.innerText = cell.querySelector("input").value;
                    } else {  
                        rowData[header] = cell.innerText;
                    }
                });

                console.log("Data to be sent:", rowData);  // Debugging

                fetch('/updatePersonInMonth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(rowData)
                }).then(response => response.json())  // Ensure proper response parsing
                    .then(data => {
                        if (data.message === "success") {
                            showCustomAlert();  // Show the modern alert
                        }
    })
                .catch(error => console.error("Error saving data:", error));
            }

    </script>
    <script>
        function uploadData(button) {
                let row = button.parentElement.parentElement;
                let rowData = {};
                let headers = document.querySelectorAll("th"); // Get all table headers

                row.querySelectorAll("td").forEach((cell, index) => {
                    if (index >= headers.length) {
                        console.warn("Skipping extra cell: ", cell);  // Debugging
                        return; // Skip extra columns if they exist
                    }

                    let header = headers[index]?.innerText.trim(); // Ensure header exists
                    if (!header) {
                        console.warn("Header not found for index", index);  // Debugging
                        return; // Skip if no header found
                    }

                    if (cell.style.display === "none") {  
                        rowData["unique_customer_id"] = cell.innerText; // Capture hidden ID
                    } else if (cell.querySelector("input")) {  
                        rowData[header] = cell.querySelector("input").value;
                        cell.innerText = cell.querySelector("input").value;
                    } else {  
                        rowData[header] = cell.innerText;
                    }
                });

                console.log("Data to be sent:", rowData);  // Debugging

                fetch('/uploadDataPage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(rowData)
                })
            .then(response => response.text())  // ✅ Expect HTML, not JSON
            .then(html => {
                document.open();
                document.write(html);
                document.close();
            })
            .catch(error => console.error("Error:", error));
        }

    </script>
</head>
<body>
    <div class="selection-container">
        <div class="container">
            <h2>Select a Month</h2>
            <select id="monthSelect" onchange="checkSelection()">
                <option value="">--Select a Month--</option>
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>
        </div>
    
        <div class="container">
            <h2>Select a Year</h2>
            <select id="yearSelect" onchange="checkSelection()">
                <option value="">--Select a Year--</option>
            </select>
        </div>

        <div class="container">
            <h2>Select Insurance Company (Optional)</h2>
            <select id="insuranceSelect">
                <option value="">--Select an Insurance Company--</option>
                <option value="Bajaj Allianz General Insurance Co. Ltd.">Bajaj Allianz General Insurance Co. Ltd.</option>
                    <option value="Cholamandalam MS General Insurance Co. Ltd.">Cholamandalam MS General Insurance Co. Ltd.</option>
                    <option value="Future Generali India Insurance Co. Ltd.">Future Generali India Insurance Co. Ltd.</option>
                    <option value="Go Digit General Insurance Ltd.">Go Digit General Insurance Ltd.</option>
                    <option value="HDFC ERGO General Insurance Co. Ltd.">HDFC ERGO General Insurance Co. Ltd.</option>
                    <option value="ICICI LOMBARD General Insurance Co. Ltd.">ICICI LOMBARD General Insurance Co. Ltd.</option>
                    <option value="IFFCO TOKIO General Insurance Co. Ltd.">IFFCO TOKIO General Insurance Co. Ltd.</option>
                    <option value="Kotak Mahindra General Insurance Co. Ltd.">Kotak Mahindra General Insurance Co. Ltd.</option>
                    <option value="Liberty General Insurance Ltd.">Liberty General Insurance Ltd.</option>
                    <option value="Magma HDI General Insurance Co. Ltd.">Magma HDI General Insurance Co. Ltd.</option>
                    <option value="National Insurance Co. Ltd.">National Insurance Co. Ltd.</option>
                    <option value="Navi General Insurance Ltd.">Navi General Insurance Ltd.</option>
                    <option value="Raheja QBE General Insurance Co. Ltd.">Raheja QBE General Insurance Co. Ltd.</option>
                    <option value="Reliance General Insurance Co. Ltd.">Reliance General Insurance Co. Ltd.</option>
                    <option value="Royal Sundaram General Insurance Co. Ltd.">Royal Sundaram General Insurance Co. Ltd.</option>
                    <option value="SBI General Insurance Co. Ltd.">SBI General Insurance Co. Ltd.</option>
                    <option value="Shriram General Insurance Co. Ltd.">Shriram General Insurance Co. Ltd.</option>
                    <option value="Tata AIG General Insurance Co. Ltd.">Tata AIG General Insurance Co. Ltd.</option>
                    <option value="The New India Assurance Co. Ltd.">The New India Assurance Co. Ltd.</option>
                    <option value="The Oriental Insurance Co. Ltd.">The Oriental Insurance Co. Ltd.</option>
                    <option value="United India Insurance Co. Ltd.">United India Insurance Co. Ltd.</option>
                    <option value="Universal Sompo General Insurance Co. Ltd.">Universal Sompo General Insurance Co. Ltd.</option>
                    <option value="Zuno General Insurance Limited (Formerly Edelweiss General Insurance Co. Ltd.)">Zuno General Insurance Limited (Formerly Edelweiss General Insurance Co. Ltd.)</option>
                
            </select>
        </div>
    
        <button id="search-btn" class="search-btn" onclick="sendData()">Search</button>
    </div>
    <div id="customAlert" class="custom-alert">Data saved successfully!</div>
    <script>
        function checkSelection() {
            let month = document.getElementById("monthSelect").value;
            let year = document.getElementById("yearSelect").value;
            let searchBtn = document.getElementById("search-btn");

            // Enable the button only if both month and year are selected
        }
        // Ensure the script runs after the DOM is fully loaded
        document.addEventListener("DOMContentLoaded", function () {
            populateYearDropdown();
        });

        // Populate Year Dropdown (from 2000 to current year)
        function populateYearDropdown() {
            const yearSelect = document.getElementById("yearSelect");

            // Clear existing options (prevents duplication)
            yearSelect.innerHTML = '<option value="">--Select a Year--</option>';

            const currentYear = new Date().getFullYear();
            for (let year = 2024; year <= currentYear+6; year++) {
                let option = document.createElement("option");
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }

        // Re-populate dropdown when coming back from history
        window.addEventListener("pageshow", function () {
            populateYearDropdown();
        });

    </script>

    <script>
    
        function sendData() {
            let month = document.getElementById("monthSelect").value;
            let year = document.getElementById("yearSelect").value;
            let insuranceCompany = document.getElementById("insuranceSelect").value;
            
            // if (!month || !year) {
            //     alert("Please select both Month and Year before searching!");
            //     return;
            // }

            let url = `/searchByMonthAndYear?month=${month}&year=${year}`;
            if (insuranceCompany) {
                url += `&insuranceCompany=${encodeURIComponent(insuranceCompany)}`;
            }
            // Simulate sending data (modify as needed)
            // Example: Sending Data via Fetch API (Modify as per your backend)
            fetch(url)
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return response.text();
            })
            .then(html => {
                        document.open();
                        document.write(html);
                        document.close();

                        sessionStorage.setItem("hasSearched", "true");
                    })
                .catch(error => console.error("Error fetching data:", error));
        }
    </script>

    {% if result %}
    <p> Month :[{{month}}]   Year : [{{year}}]</p>
    <div class="table-container">
    <table border="1">
        <thead>
            <tr>
                <th style="display: none;">unique_customer_id</th>
                <th>Date</th>
                <th>Person Name</th>
                <th>ID value (₹)</th>
                <th>New ID value (₹)</th>
                <th>OD value (₹)</th>
                <th>New OD value (₹)</th>
                <th>Final Premium (₹)</th>
                <th>New Final Premium (₹)</th>
                <th>NCB (%)</th>
                <th>New NCB (%)</th>
                <th>Insured Company</th>
                <th>Insurer Code</th>
                <th>New Company</th>
            </tr>
        </thead>
        <tbody>
            {% for person in result %}
            <tr>
                <td style="display: none;">{{person.id}}</td>
                <td style="white-space: nowrap;">
                    {% if person.Date_of_insurance.__class__.__name__ == 'datetime' %}
                                {{ person.Date_of_insurance.strftime('%d-%m-%Y') }}
                            {% elif person.Date_of_insurance.__class__.__name__ == 'date' %}
                                {{ person.Date_of_insurance.strftime('%d-%m-%Y') }}
                            {% else %}
                                {% set parts = person.Date_of_insurance.split('-') %}
                                {{ parts[2] ~ '-' ~ parts[1] ~ '-' ~ parts[0] }}
                            {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('fullPersonDetails', person_id=person.id) }}">
                        {{ person.Customer_name }}
                    </a>
                </td>
                <td>{{ person.Old_ID_value }}</td>
                <td onclick="makeEditable(this)">{{ person.New_ID_value }}</td>
                <td>{{ person.Old_OD_value }}</td>
                <td onclick="makeEditable(this)">{{ person.New_OD_value }}</td>
                <td>{{ person.Old_final_premium }}</td>
                <td onclick="makeEditable(this)">{{ person.New_final_premium }}</td>
                <td>{{ person.Ncb }}</td>
                <td onclick="makeEditable(this)">{{ person.New_NCB }}</td>
                <td>{{ person.Insured_Company }}</td>
                <td>{{ person.Insurer_Code }}</td>
                <td onclick="makeEditable(this)">{{ person.New_Company }}</td>
                <td><button class = save-btn onclick="saveRow(this)">Save</button></td>
                <td><button onclick="uploadData(this)">Upload Docs</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>

    {% elif filter_result %}
        <p>Month : [{{month}}]   Year : [{{year}}]</p>
        <div class="table-container">
        <table border="1">
            <thead>
                <tr>
                    <th style="display: none;">unique_customer_id</th>
                    <th>Person Name/th>
                    <th>ID value (₹)</th>
                    <th>New ID value (₹)</th>
                    <th>OD value (₹)</th>
                    <th>New OD value (₹)</th>
                    <th>Final Premium (₹)</th>
                    <th>New Final Premium (₹)</th>
                    <th>NCB (%)</th>
                    <th>New NCB (%)</th>
                    <th>Insured Company</th>
                    <th>Insurer Code</th>
                    <th>New Company</th>
                </tr>
            </thead>
            <tbody>
                {% for person in filter_result %}
                <tr>
                    <td style="display: none;">{{person.id}}</td>
                    <td style="white-space: nowrap;">
                        {% if person.Date_of_insurance.__class__.__name__ == 'datetime' %}
                                    {{ person.Date_of_insurance.strftime('%d-%m-%Y') }}
                                {% elif person.Date_of_insurance.__class__.__name__ == 'date' %}
                                    {{ person.Date_of_insurance.strftime('%d-%m-%Y') }}
                                {% else %}
                                    {% set parts = person.Date_of_insurance.split('-') %}
                                    {{ parts[2] ~ '-' ~ parts[1] ~ '-' ~ parts[0] }}
                                {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('fullPersonDetails', person_id=person.id) }}">
                            {{ person.Customer_name }}
                        </a>
                    </td>
                    <td>{{ person.Old_ID_value }}</td>
                    <td onclick="makeEditable(this)">{{ person.New_ID_value }}</td>
                    <td>{{ person.Old_OD_value }}</td>
                    <td onclick="makeEditable(this)">{{ person.New_OD_value }}</td>
                    <td>{{ person.Old_final_premium }}</td>
                    <td onclick="makeEditable(this)">{{ person.New_final_premium }}</td>
                    <td>{{ person.Ncb }}</td>
                    <td onclick="makeEditable(this)">{{ person.New_NCB }}</td>
                    <td>{{ person.Insured_Company }}</td>
                    <td>{{ person.Insurer_Code }}</td>
                    <td onclick="makeEditable(this)">{{ person.New_Company }}</td>
                    <td><button class = save-btn onclick="saveRow(this)">Save</button></td>
                    <td><button onclick="uploadData(this)">Upload Docs</button></td>
                </tr>
                {% endfor %}
            </tbody>
            </table>
        </div>
    {% endif %}
</body>
</html>
